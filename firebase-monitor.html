<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MI7 - Firebase Database Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: #f3f4f6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #0d9488 0%, #115e59 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .status {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 15px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .card-header {
            background: linear-gradient(135deg, #0d9488 0%, #115e59 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .card-header h2 {
            font-size: 18px;
        }
        
        .card-icon {
            font-size: 24px;
        }
        
        .card-content {
            padding: 20px;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .stat:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 13px;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: #0d9488;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .table thead {
            background: #f3f4f6;
        }
        
        .table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .table tbody tr:hover {
            background: #f9fafb;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .badge-expense {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-contribution {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-meal {
            background: #fef3c7;
            color: #92400e;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #0d9488;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0f766e;
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background: #d1d5db;
        }
        
        .empty {
            text-align: center;
            padding: 40px;
            color: #9ca3af;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e5e7eb;
            border-top-color: #0d9488;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .info-box {
            background: #eff6ff;
            border-left: 4px solid #0284c7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #0c4a6e;
        }
        
        .connect-button {
            padding: 15px 30px;
            font-size: 16px;
            background: #0d9488;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
        }
        
        .connect-button:hover {
            background: #0f766e;
            transform: translateY(-2px);
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üìä Firebase Database Monitor</h1>
            <p>Real-time monitoring of your MI7 Meal Manager data</p>
            <div class="status">
                <span id="statusText">üî¥ Not connected</span>
            </div>
        </div>
        
        <!-- Connection Setup -->
        <div class="card" id="setupCard" style="margin-bottom: 30px;">
            <div class="card-header">
                <h2>üîó Connect to Firebase</h2>
                <span class="card-icon">‚öôÔ∏è</span>
            </div>
            <div class="card-content">
                <div class="info-box">
                    To monitor your database, connect to Firebase using your credentials from <a href="firebase-config-setup.html" style="color: inherit; font-weight: bold;">firebase-config-setup.html</a>
                </div>
                <button class="connect-button" onclick="connectToFirebase()">
                    üöÄ Load Configuration & Connect
                </button>
            </div>
        </div>
        
        <div style="max-width:800px;margin:40px auto;font-family:Inter,Arial,sans-serif;">
            <h1 style="font-size:1.5rem;">Firebase Monitor (moved)</h1>
            <p>This file previously included project-specific details. To keep credentials private,
            a copy of the monitor has been moved to <code>private/firebase-monitor.html</code>.</p>
            <p>If you need to use the monitor locally, open the file in <code>private/</code> instead.</p>
        </div>
                <button class="btn btn-secondary" onclick="clearAll()">üóëÔ∏è Clear Data</button>
            </div>
            
            <!-- Stats Cards -->
            <div class="grid">
                <div class="card">
                    <div class="card-header">
                        <h2>Expenses</h2>
                        <span class="card-icon">üí∏</span>
                    </div>
                    <div class="card-content">
                        <div class="stat">
                            <span class="stat-label">Total Entries</span>
                            <span class="stat-value" id="expenseCount">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Total Amount</span>
                            <span class="stat-value" id="expenseTotal">‡ß≥0</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2>Contributions</h2>
                        <span class="card-icon">üí∞</span>
                    </div>
                    <div class="card-content">
                        <div class="stat">
                            <span class="stat-label">Total Entries</span>
                            <span class="stat-value" id="contributionCount">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Total Amount</span>
                            <span class="stat-value" id="contributionTotal">‡ß≥0</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2>Meals</h2>
                        <span class="card-icon">üçΩÔ∏è</span>
                    </div>
                    <div class="card-content">
                        <div class="stat">
                            <span class="stat-label">Total Entries</span>
                            <span class="stat-value" id="mealCount">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Latest Date</span>
                            <span class="stat-value" id="mealLatest">‚Äî</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Data Tables -->
            <div class="grid">
                <!-- Expenses Table -->
                <div class="card">
                    <div class="card-header">
                        <h2>Recent Expenses</h2>
                        <span class="card-icon">üìã</span>
                    </div>
                    <div class="card-content">
                        <div class="loading" id="expenseLoading">
                            <div class="spinner"></div>
                        </div>
                        <table class="table" id="expenseTable" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Description</th>
                                    <th>Amount</th>
                                    <th>Paid By</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="expenseBody"></tbody>
                        </table>
                        <div class="empty" id="expenseEmpty">No expenses yet</div>
                    </div>
                </div>
                
                <!-- Contributions Table -->
                <div class="card">
                    <div class="card-header">
                        <h2>Recent Contributions</h2>
                        <span class="card-icon">üìã</span>
                    </div>
                    <div class="card-content">
                        <div class="loading" id="contributionLoading">
                            <div class="spinner"></div>
                        </div>
                        <table class="table" id="contributionTable" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="contributionBody"></tbody>
                        </table>
                        <div class="empty" id="contributionEmpty">No contributions yet</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        let db = null;
        let appId = 'default-meal-app';
        
        async function connectToFirebase() {
            try {
                const savedConfig = localStorage.getItem('firebaseConfig');
                if (!savedConfig) {
                    alert('‚ùå No Firebase configuration found. Please setup Firebase first via firebase-config-setup.html');
                    window.location.href = 'firebase-config-setup.html';
                    return;
                }
                
                const firebaseConfig = JSON.parse(savedConfig);
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                
                document.getElementById('setupCard').style.display = 'none';
                document.getElementById('dashboardArea').style.display = 'block';
                document.getElementById('statusText').textContent = 'üü¢ Connected';
                
                setupListeners();
            } catch (error) {
                console.error('Connection error:', error);
                alert('‚ùå Failed to connect: ' + error.message);
            }
        }
        
        function setupListeners() {
            if (!db) return;
            
            const basePath = `artifacts/${appId}/public/data`;
            
            // Listen for expenses
            onSnapshot(query(collection(db, `${basePath}/expenses`)), (snapshot) => {
                const expenses = [];
                snapshot.forEach(doc => expenses.push(doc.data()));
                displayExpenses(expenses);
            });
            
            // Listen for contributions
            onSnapshot(query(collection(db, `${basePath}/contributions`)), (snapshot) => {
                const contributions = [];
                snapshot.forEach(doc => contributions.push(doc.data()));
                displayContributions(contributions);
            });
            
            // Listen for meals
            onSnapshot(query(collection(db, `${basePath}/meals`)), (snapshot) => {
                const meals = [];
                snapshot.forEach(doc => meals.push(doc.data()));
                displayMeals(meals);
            });
        }
        
        function displayExpenses(expenses) {
            const total = expenses.reduce((sum, e) => sum + (Number(e.amount) || 0), 0);
            const body = document.getElementById('expenseBody');
            
            document.getElementById('expenseCount').textContent = expenses.length;
            document.getElementById('expenseTotal').textContent = '‡ß≥' + total.toFixed(2);
            
            body.innerHTML = expenses.slice(0, 10).map(e => `
                <tr>
                    <td>${e.description || '‚Äî'}</td>
                    <td>‡ß≥${Number(e.amount).toFixed(2)}</td>
                    <td>${e.spentBy || '‚Äî'}</td>
                    <td>${e.date || '‚Äî'}</td>
                </tr>
            `).join('');
            
            document.getElementById('expenseLoading').style.display = 'none';
            document.getElementById('expenseTable').style.display = expenses.length > 0 ? 'table' : 'none';
            document.getElementById('expenseEmpty').style.display = expenses.length === 0 ? 'block' : 'none';
        }
        
        function displayContributions(contributions) {
            const total = contributions.reduce((sum, c) => sum + (Number(c.amount) || 0), 0);
            const body = document.getElementById('contributionBody');
            
            document.getElementById('contributionCount').textContent = contributions.length;
            document.getElementById('contributionTotal').textContent = '‡ß≥' + total.toFixed(2);
            
            body.innerHTML = contributions.slice(0, 10).map(c => `
                <tr>
                    <td>${c.name || '‚Äî'}</td>
                    <td>‡ß≥${Number(c.amount).toFixed(2)}</td>
                    <td>${c.date || '‚Äî'}</td>
                </tr>
            `).join('');
            
            document.getElementById('contributionLoading').style.display = 'none';
            document.getElementById('contributionTable').style.display = contributions.length > 0 ? 'table' : 'none';
            document.getElementById('contributionEmpty').style.display = contributions.length === 0 ? 'block' : 'none';
        }
        
        function displayMeals(meals) {
            document.getElementById('mealCount').textContent = meals.length;
            if (meals.length > 0) {
                const latest = meals.reduce((a, b) => a.date > b.date ? a : b);
                document.getElementById('mealLatest').textContent = latest.date || '‚Äî';
            }
        }
        
        function refreshData() {
            console.log('Refreshing data...');
        }
        
        function clearAll() {
            if (confirm('‚ö†Ô∏è Clear all data? This cannot be undone!')) {
                alert('Feature coming soon');
            }
        }
        
        // Auto-connect on load
        window.addEventListener('load', connectToFirebase);
        
        // Make functions global
        window.connectToFirebase = connectToFirebase;
        window.refreshData = refreshData;
        window.clearAll = clearAll;
    </script>
</body>
</html>
